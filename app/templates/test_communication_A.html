<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
    <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css'>
    <link rel="stylesheet" href="../static/chat-widget/dist/style.css">

    <script src= "../static/script/jquery.min.js"></script>
    <script src="../static/script/socket.io.js"></script>
    <script src="../static/script/av-min.js"></script>

    <script src="../static/script/im-browser.min.js"></script>
    <script src="../static/script/typed-messages.min.js"></script>

    <script src="../static/script/user.js"></script>
    <script src="../static/script/communication.js"></script>

    <script src="https://www.jq22.com/jquery/jquery-1.10.2.js"></script>
    <script src='../static/chat-widget/dist/handlebars.min.js'></script>
    <script src='../static/chat-widget/dist/list.min.js'></script>
    <script src="../static/chat-widget/dist/script.js"></script>
</head>
<body>

<div class="container clearfix">
    <div class="chat">
      <!-- 聊天框头部 -->
      <div class="chat-header clearfix">
        <img src="img/t1.png" alt="avatar" />

        <div class="chat-about">
          <div class="chat-with">Chat with Vincent Porter</div>
          <div class="chat-num-messages">already 1 902 messages</div>
        </div>
        <i class="fa fa-star"></i>
      </div> <!-- end chat-header -->



<!--      <div class="chat-history">-->
<!--        <ul>-->
<!--          <li class="clearfix">-->
<!--            <div class="message-data align-right">-->
<!--              <span class="message-data-time" >10:10 AM, Today</span> &nbsp; &nbsp;-->
<!--              <span class="message-data-name" >Olia</span> <i class="fa fa-circle me"></i>-->
<!--              -->
<!--            </div>-->
<!--            <div class="message other-message float-right">-->
<!--              Hi Vincent, how are you? How is the project coming along?-->
<!--            </div>-->
<!--          </li>-->
<!--          -->
<!--          <li>-->
<!--            <div class="message-data">-->
<!--              <span class="message-data-name"><i class="fa fa-circle online"></i> Vincent</span>-->
<!--              <span class="message-data-time">10:12 AM, Today</span>-->
<!--            </div>-->
<!--            <div class="message my-message">-->
<!--              Are we meeting today? Project has been already finished and I have results to show you.-->
<!--            </div>-->
<!--          </li>-->
<!--          -->
<!--          <li class="clearfix">-->
<!--            <div class="message-data align-right">-->
<!--              <span class="message-data-time" >10:14 AM, Today</span> &nbsp; &nbsp;-->
<!--              <span class="message-data-name" >Olia</span> <i class="fa fa-circle me"></i>-->
<!--              -->
<!--            </div>-->
<!--            <div class="message other-message float-right">-->
<!--              Well I am not sure. The rest of the team is not here yet. Maybe in an hour or so? Have you faced any problems at the last phase of the project?-->
<!--            </div>-->
<!--          </li>-->
<!--          -->
<!--          <li>-->
<!--            <div class="message-data">-->
<!--              <span class="message-data-name"><i class="fa fa-circle online"></i> Vincent</span>-->
<!--              <span class="message-data-time">10:20 AM, Today</span>-->
<!--            </div>-->
<!--            <div class="message my-message">-->
<!--              Actually everything was fine. I'm very excited to show this to our team.-->
<!--            </div>-->
<!--          </li>-->
<!--          -->
<!--          <li>-->
<!--            <div class="message-data">-->
<!--              <span class="message-data-name"><i class="fa fa-circle online"></i> Vincent</span>-->
<!--              <span class="message-data-time">10:31 AM, Today</span>-->
<!--            </div>-->
<!--            <i class="fa fa-circle online"></i>-->
<!--            <i class="fa fa-circle online" style="color: #AED2A6"></i>-->
<!--            <i class="fa fa-circle online" style="color:#DAE9DA"></i>-->
<!--          </li>-->
<!--          -->
<!--        </ul>-->
<!--        -->
<!--      </div> &lt;!&ndash; end chat-history &ndash;&gt;-->

      <div class="chat-message clearfix">
        <textarea name="message-to-send" id="message-to-send" placeholder ="Type your message" rows="3"></textarea>

        <i class="fa fa-file-o"></i> &nbsp;&nbsp;&nbsp;
        <i class="fa fa-file-image-o"></i>

        <button>Send</button>

      </div> <!-- end chat-message -->

    </div> <!-- end chat -->
</div> <!-- end container -->

<script id="message-template" type="text/x-handlebars-template">
  <li class="clearfix">
    <div class="message-data align-right">
      <span class="message-data-time" >{{time}}, Today</span> &nbsp; &nbsp;
      <span class="message-data-name" >Olia</span> <i class="fa fa-circle me"></i>
    </div>
    <div class="message other-message float-right">
      {{messageOutput}}
    </div>
  </li>
</script>

<script id="message-response-template" type="text/x-handlebars-template">
  <li>
    <div class="message-data">
      <span class="message-data-name"><i class="fa fa-circle online"></i> Vincent</span>
      <span class="message-data-time">{{time}}, Today</span>
    </div>
    <div class="message my-message">
      {{response}}
    </div>
  </li>
</script>
<!-- partial -->








<label>
    <input type="text" id = 'people'>
</label>

<label>
    <input type="text" id = 'message'>
</label>
<button onclick="sendMessage()">send</button>
<div id = 'talk'>

</div>


<script>

    console.log(user_name);
    var { Realtime, TextMessage,Event } = AV;
const realtime = new Realtime({
  appId: 'pPObpvTV7pQB9poQHO1NJoMP-MdYXbMMI',
  appKey: 'pShwYQQ4JVfSStc56MvkHNrr',
});
AV.init({
  appId: "pPObpvTV7pQB9poQHO1NJoMP-MdYXbMMI",
  appKey: "pShwYQQ4JVfSStc56MvkHNrr",
});

function sendMessage(){
    let username = $('#people').val();
    let message = $('#message').val();
    realtime.createIMClient(user_name).then(function(user) {
			  return user.createConversation({
				members: [username],
				name: message,
				unique: true
			  });
			}).then(function(conversation) {
			  // 发送消息
			  return conversation.send(new TextMessage(message));
			}).then(function(message) {
			  console.log(message.text, '发送成功！');
			}).catch(console.error);

    let el = $('<p>'+user_name+' : '+message+'</p>');
    $('#talk').append(el);
}

realtime.createIMClient(user_name).then(function(user) {
    let username = $('#people').val();
			  user.on(Event.MESSAGE, function(message, conversation) {
				console.log('Message received: ' + message.text);
				 let el = $('<p>'+username+' : '+message.text+'</p>');
                $('#talk').append(el);
			  });
			}).catch(console.error);

</script>
</body>





</html>